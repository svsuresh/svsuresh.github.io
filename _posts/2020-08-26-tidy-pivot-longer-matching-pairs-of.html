---
layout: post
title: Clean data with altenating match pair columns
date: '2020-08-26T12:06:00.005+05:30'
author: suresh
tags:
- tidyr
- pivot
- alternate columns
- pivot_longer
modified_time: '2020-08-26T12:40:29.042+05:30'
thumbnail: https://1.bp.blogspot.com/-vk7ssa4zddo/X0YFrRRQxZI/AAAAAAAABgw/0vVYuo3RO_UA4__PyJhgKMqja98iTg97wCLcBGAsYHQ/s72-c/test.png
blogger_id: tag:blogger.com,1999:blog-3175511529662794199.post-4988183449535754723
blogger_orig_url: https://digibio.blogspot.com/2020/08/tidy-pivot-longer-matching-pairs-of.html
---

<p style="text-align: justify;">One of the data formats we encounter is matching pair columns either alternating or as batches. For eg.</p><p>============================================================</p><p>x1<span>&nbsp;&nbsp; &nbsp;</span>y1 <span>&nbsp;&nbsp; &nbsp;</span>x2 <span>&nbsp;&nbsp; &nbsp;</span>y2</p><p>1<span>&nbsp;&nbsp; &nbsp;</span>2<span>&nbsp;&nbsp;&nbsp; </span>3<span>&nbsp;&nbsp;&nbsp; </span>4</p><p>============================================================</p><p>or&nbsp;</p><p>=============================================================<br /></p><p>x1<span>&nbsp;&nbsp; &nbsp;</span>x2<span>&nbsp;&nbsp; &nbsp;</span>y1<span>&nbsp;&nbsp; &nbsp;</span>y2</p><p>1<span>&nbsp;&nbsp;&nbsp; </span>2<span>&nbsp;&nbsp;&nbsp; </span>3<span>&nbsp;&nbsp;&nbsp; </span>4</p><p>============================================================.</p><p>Expected format is</p><p>==============================================================</p><p><span>&nbsp; <span>&nbsp;&nbsp;&nbsp;</span></span>1<span>&nbsp;&nbsp;&nbsp; </span>2 <br /></p><p>X<span><span>&nbsp;&nbsp;&nbsp; 1</span><span>&nbsp;&nbsp;&nbsp; </span>2 &nbsp;</span><span>&nbsp;&nbsp; &nbsp;</span></p><p>Y<span>&nbsp;&nbsp; &nbsp;</span><span></span>3<span>&nbsp;&nbsp;&nbsp; </span>4</p><p>==============================================================<br /></p><p style="text-align: justify;">We can imagine any such combinations with number and texts. In this note, we would learn how to change such data from wider format to longer format. Let us look at example data</p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-vk7ssa4zddo/X0YFrRRQxZI/AAAAAAAABgw/0vVYuo3RO_UA4__PyJhgKMqja98iTg97wCLcBGAsYHQ/s648/test.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="260" data-original-width="648" src="https://1.bp.blogspot.com/-vk7ssa4zddo/X0YFrRRQxZI/AAAAAAAABgw/0vVYuo3RO_UA4__PyJhgKMqja98iTg97wCLcBGAsYHQ/s640/test.png" width="640" /></a></div><p style="text-align: justify;">You can download this data from <a href="https://docs.google.com/document/d/1PbFtUNRrmsL5cB35yeVhxOLVcAMbZhxc8zCGYa5NdJY/edit?usp=sharing">here</a>. Data has following characteristics:</p><ol style="text-align: justify;"><li>There are 3 groups with columns.&nbsp;</li><li>Each column is preceded by entity names (for eg. gene names, dog names or cat names)</li><li>All the "Name" columns have same headers. While importing into R, R converts these names to unique by appending numbers to the duplicate headers.&nbsp;</li></ol><p style="text-align: justify;">Final output would be some thing like this:</p><p></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-_6Az1pFY57A/X0YHvLxYZTI/AAAAAAAABg8/f-YhviqBAoIpjJH3oQVRvvOQo3dZo67DQCLcBGAsYHQ/s393/test2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="347" data-original-width="393" height="434" src="https://1.bp.blogspot.com/-_6Az1pFY57A/X0YHvLxYZTI/AAAAAAAABg8/f-YhviqBAoIpjJH3oQVRvvOQo3dZo67DQCLcBGAsYHQ/w491-h434/test2.png" width="491" /></a></div>Now this format looks like youtube/ebaumsworld before and after health photos. Please note that that missing data "NA" is converted to 0 (zero) which is not correct. Please change the code as per your convenience. Here is the code:<p></p><p>================================================================= <br /></p><p>df %&gt;%<br />&nbsp;&nbsp;&nbsp; rename_at(vars(starts_with("Name")), ~paste("Name", seq(1:(ncol(df)/2)),sep=".")) %&gt;%<br />&nbsp;&nbsp;&nbsp; pivot_longer(everything(),names_to = c(".value", "set"),names_pattern = "(\\D+)(\\d)") %&gt;%<br />&nbsp;&nbsp;&nbsp; drop_na()%&gt;%<br />&nbsp;&nbsp;&nbsp; pivot_wider(names_from="set", values_from="Group.", names_prefix = "Group.", values_fill = 0) %&gt;%<br />&nbsp;&nbsp;&nbsp; arrange(Name.)</p><p>====================================================================</p><p>Explanation for the code:</p><p>==================================================================</p><p>df %&gt;% -- loads df data<br />rename_at(vars(starts_with("Name")), ~paste("Name", seq(1:(ncol(df)/2)),sep=".")) %&gt;% -- Change the name of columns starting with word "Name" to Name1, Name2, Name3<br />pivot_longer(everything(),names_to = c(".value", "set"),names_pattern = "(\\D+)(\\d)") %&gt;% -- Convert the data to longer format. But break down the column names and store the later part of the split in a column named "set". Split pattern (\\D+)- any thing that is not digit and more of non-digit things (+). (\\d) - any thing that is digit.<br />drop_na()%&gt;% -- Remove empty rows<br />pivot_wider(names_from="set", values_from="Group.", names_prefix = "Group.", values_fill = 0) %&gt;% -- Change to wider format and replace missing values (NA) with zero.<br />arrange(Name.) -- sort the final data frame (tibble) on column "Name." (. is part of the column name. You should edit it.It may cause problems in future).</p><p>==================================================================<br /></p><p><b>Note</b>: This trick works only if alternating columns share same kind of naming pattern. For eg. Name.digits, Name_digits, Namedigits (x.1, y.1, x1,y1, x_1,y_1 etc).&nbsp; <br /></p><p><br /></p>